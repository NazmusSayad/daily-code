{"version":3,"file":"browser.cjs","sources":["../src/browser/element.ts","../src/browser/file-explorer.ts","../src/browser/find-dominant-color.ts","../src/base/hex-to-rgb.ts","../src/browser/mono-color-image/lib.ts","../src/browser/mono-color-image/index.ts"],"sourcesContent":["/**\n * Creates an HTMLElement from an HTML string.\n * @param input HTML string to convert\n * @returns The first HTMLElement parsed from the string\n * @example\n *   createElementFromString('<div>Hello</div>') // <div>Hello</div>\n */\nexport function createElementFromString(input: string): HTMLElement {\n  return new DOMParser().parseFromString(input, 'text/html').body\n    .firstElementChild as HTMLElement\n}\n","/**\n * Options for the file explorer dialog.\n */\ntype FileExplorerOptions = {\n  accept?: string\n  multiple?: boolean\n}\n\n/**\n * Opens a file picker dialog and returns the selected files.\n * @param options Options for accepted file types and multiple selection\n * @returns A promise that resolves to the selected FileList\n * @throws {Error} If no files are selected\n */\nexport function openFileExplorer(options: FileExplorerOptions = {}) {\n  return new Promise<FileList>((resolve, reject) => {\n    const input = document.createElement('input')\n    input.type = 'file'\n\n    input.accept = options.accept ?? 'image/*'\n    input.multiple = options.multiple ?? false\n\n    input.onchange = async (e) => {\n      const files = (e.target as HTMLInputElement).files\n      if (!files) return reject(new Error('No files selected'))\n      resolve(files)\n    }\n\n    input.click()\n  })\n}\n","const ENABLE_LOGGING = false\nconst DEFAULT_SAMPLE_COUNT = 20\n\n/**\n * Finds the dominant color in an image.\n * @param src - The URL of the image to find the dominant color of.\n * @param sampleThreshold - The threshold for sampling the image.\n * @returns A promise that resolves to the dominant color.\n * @example\n * ```js\n * findDominantColor('https://example.com/image.png')\n * // #F29034\n * ```\n */\nexport function findDominantColor(\n  src: string,\n  sampleThreshold?: number\n): Promise<string> {\n  const imgEl = document.createElement('img')\n  imgEl.src = src\n\n  return new Promise((resolve, reject) => {\n    imgEl.onload = () => {\n      try {\n        const canvas = document.createElement('canvas')\n        resolve(getDominantColor(canvas, imgEl, sampleThreshold))\n      } catch (err) {\n        if (err instanceof Error) {\n          reject(err)\n        } else {\n          reject(new Error('Failed to get dominant color.'))\n        }\n      }\n    }\n\n    imgEl.onerror = () => {\n      reject(\n        new Error(\n          'Failed to load image. Ensure the image URL allows cross-origin requests.'\n        )\n      )\n    }\n  })\n}\n\nfunction getDominantColor(\n  canvas: HTMLCanvasElement,\n  imgEl: HTMLImageElement,\n  sampleThreshold?: number\n) {\n  const ctx = canvas.getContext('2d')\n  if (!ctx) {\n    throw new Error('Failed to get canvas context')\n  }\n\n  const colorsMap = new Map<string, number>()\n\n  canvas.width = imgEl.naturalWidth\n  canvas.height = imgEl.naturalHeight\n\n  ctx.drawImage(imgEl, 0, 0)\n  const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data\n\n  const totalPixels = canvas.width * canvas.height\n  const skipThreshold =\n    4 *\n    Math.max(\n      1,\n      Math.round(\n        totalPixels /\n          (sampleThreshold ? sampleThreshold ** 2 : DEFAULT_SAMPLE_COUNT)\n      )\n    )\n\n  if (ENABLE_LOGGING) {\n    console.log('Src:', imgEl.src)\n    console.log('Canvas size:', canvas.width, canvas.height)\n    console.log('Total pixels:', totalPixels)\n\n    console.log('Data length:', data.length)\n    console.log('Skip threshold:', skipThreshold)\n    console.log('Sample count:', Math.floor(data.length / skipThreshold))\n\n    console.log('\\n')\n  }\n\n  for (let i = 0; i < data.length; i += skipThreshold) {\n    const color = [data[i], data[i + 1], data[i + 2]].join(',')\n\n    if (colorsMap.has(color)) {\n      colorsMap.set(color, colorsMap.get(color)! + 1)\n    } else {\n      colorsMap.set(color, 1)\n    }\n  }\n\n  const sortedColors = Array.from(colorsMap.entries()).sort(\n    (a, b) => b[1] - a[1]\n  )\n  const rgbValue = sortedColors?.[0]?.[0]?.trim()\n\n  if (!rgbValue) {\n    throw new Error('No dominant color found.')\n  }\n\n  if (ENABLE_LOGGING) {\n    console.log('Sorted colors:', sortedColors)\n    console.log('Dominant color:', rgbValue)\n  }\n\n  return `rgb(${rgbValue})`\n}\n","/**\n * Converts a hex color code to an RGB object.\n * @param hex - The hex color code to convert.\n * @returns An object with the red, green, and blue values.\n * @throws {Error} If the hex color code is invalid.\n * @example\n * ```js\n * hexToRGB('#ff0000') // { r: 255, g: 0, b: 0 }\n * ```\n */\nexport function hexToRGB(hex: string) {\n  let localHex = hex.toUpperCase()\n\n  if (/^#[0-9A-F]{3}$/.test(localHex)) {\n    localHex = `#${localHex[1]}${localHex[1]}${localHex[2]}${localHex[2]}${localHex[3]}${localHex[3]}`\n  }\n\n  if (!/^#[0-9A-F]{6}$/.test(localHex)) {\n    throw new Error('Invalid hex color code')\n  }\n\n  const color = localHex.replace('#', '')\n  const r = parseInt(color.substring(0, 2), 16)\n  const g = parseInt(color.substring(2, 4), 16)\n  const b = parseInt(color.substring(4, 6), 16)\n\n  return { r, g, b }\n}\n","/**\n * Calculates the CRC32 checksum for an array of bytes.\n * @param bytes The input byte array\n * @returns The CRC32 checksum as a 4-byte array\n */\nexport function crc32(bytes: number[]): number[] {\n  let crc = ~0\n  for (let i = 0; i < bytes.length; i++) {\n    crc ^= bytes[i]\n    for (let j = 0; j < 8; j++) {\n      crc = (crc >>> 1) ^ (crc & 1 ? 0xedb88320 : 0)\n    }\n  }\n  crc = ~crc\n  return [(crc >>> 24) & 255, (crc >>> 16) & 255, (crc >>> 8) & 255, crc & 255]\n}\n\n/**\n * Calculates the Adler-32 checksum for an array of bytes.\n * @param data The input byte array\n * @returns The Adler-32 checksum as a 4-byte array\n */\nexport function adler32(data: number[]): number[] {\n  const MOD_ADLER = 65521\n  let s1 = 1\n  let s2 = 0\n  for (let i = 0; i < data.length; i++) {\n    s1 = (s1 + data[i]) % MOD_ADLER\n    s2 = (s2 + s1) % MOD_ADLER\n  }\n  return [(s2 >>> 8) & 255, s2 & 255, (s1 >>> 8) & 255, s1 & 255]\n}\n\n/**\n * Creates a PNG chunk with the given type and data.\n * @param type The 4-character chunk type\n * @param data The chunk data as a byte array\n * @returns The PNG chunk as a byte array\n */\nexport function chunk(type: string, data: number[]): number[] {\n  const length = data.length\n  const typeBytes = [...type].map((c) => c.charCodeAt(0))\n  const crc = crc32([...typeBytes, ...data])\n  return [\n    (length >>> 24) & 255,\n    (length >>> 16) & 255,\n    (length >>> 8) & 255,\n    length & 255,\n    ...typeBytes,\n    ...data,\n    ...crc,\n  ]\n}\n","import { hexToRGB } from '@/base/hex-to-rgb'\nimport { adler32, chunk } from './lib'\n\n/**\n * @param color - Hex color code (e.g. #FFFF00 or #FF0)\n * @returns Base64 encoded PNG image data URL of a 1x1 pixel image with the specified color\n *\n * @example\n * ```js\n * generateColorImage('#ff0000')\n * // data:image/png;base64,iVBO...\n * ```\n *\n * @throws {Error} If the hex color code is invalid or if Buffer is not available in the environment\n *\n * @requires Buffer\n * @requires Uint8Array\n */\nexport function monoColorImage(color: string): string {\n  const { r, g, b } = hexToRGB(color)\n\n  const idatRawData = [0x00, r, g, b]\n  const adler = adler32(idatRawData)\n\n  const zlibStream = [\n    0x78,\n    0x01,\n    0x01,\n    0x04,\n    0x00,\n    0xfb,\n    0xff,\n    ...idatRawData,\n    ...adler,\n  ]\n\n  const png = [\n    0x89,\n    0x50,\n    0x4e,\n    0x47,\n    0x0d,\n    0x0a,\n    0x1a,\n    0x0a,\n    ...chunk('IHDR', [0, 0, 0, 1, 0, 0, 0, 1, 8, 2, 0, 0, 0]),\n    ...chunk('IDAT', zlibStream),\n    ...chunk('IEND', []),\n  ]\n\n  if (typeof Buffer === 'undefined' || typeof Buffer.from !== 'function') {\n    throw new Error('Buffer is not available in this environment')\n  }\n\n  const base64 = Buffer.from(Uint8Array.from(png)).toString('base64')\n  return `data:image/png;base64,${base64}`\n}\n"],"names":[],"mappings":"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"}