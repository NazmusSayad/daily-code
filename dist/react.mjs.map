{"version":3,"file":"react.mjs","sources":["../src/react/create-context.tsx","../src/react/create-react-suspense.ts","../src/react/error-boundary.ts","../src/react/use-effect-except-on-mount.ts","../src/react/use-effect-state.ts","../src/react/use-suspense-react.ts"],"sourcesContent":["import { PrettifyRecord } from '@/types'\nimport * as React from 'react' \n\nexport type CreateContextOptions<TOutput> = {\n  displayName?: string\n  initialValue?: TOutput\n\n  useProvider?: (children: React.ReactNode, props: TOutput) => React.ReactNode\n\n  useContext?: (\n    context: NoInfer<TOutput> | undefined\n  ) => PrettifyRecord<TOutput>\n\n  useContextHandler?: (\n    context: React.Context<TOutput | undefined>\n  ) => PrettifyRecord<TOutput>\n}\n\n/**\n * @description Create a context with very easy to use hook\n *\n * @example\n * ```tsx\n * const [CounterProvider, useCounter] = createContext(() => {\n *   const [count, setCount] = useState(0)\n *\n *   return {\n *    count,\n *    setCount,\n *   }\n * })\n *\n * function App() {\n *   return (\n *     <CounterProvider>\n *       <Counter />\n *     </CounterProvider>\n *   )\n * }\n *\n * function Counter() {\n *   const { count, setCount } = useCounter()\n *   return <button onClick={() => setCount((prev) => prev + 1)}>Increment</button>\n * }\n * ```\n */\nexport function createContext<const TInput extends object, const TOutput>(\n  useValue: (props: TInput) => TOutput,\n  options?: CreateContextOptions<NoInfer<TOutput>>\n) {\n  type PrettifiedOutput = PrettifyRecord<NoInfer<TOutput>>\n  const displayName = options?.displayName ?? 'Daily Code / React Context'\n\n  const nativeContext = React.createContext(options?.initialValue)\n  nativeContext.displayName = displayName\n\n  function useContext(): PrettifiedOutput {\n    if (options?.useContextHandler) {\n      return options.useContextHandler(nativeContext)\n    }\n\n    const context = React.useContext(nativeContext)\n\n    if (options?.useContext) {\n      return options.useContext(context)\n    }\n\n    if (context === undefined) {\n      throw new Error(`${displayName}: Used outside of its provider`)\n    }\n\n    return context as PrettifiedOutput\n  }\n\n  function ContextProvider({\n    children,\n    ...props\n  }: React.PropsWithChildren<TInput>) {\n    const providerValue = useValue(props as TInput)\n\n    const providerChildren = options?.useProvider\n      ? options.useProvider(children, providerValue)\n      : children\n\n    return (\n      <nativeContext.Provider value={providerValue}>\n        {providerChildren}\n      </nativeContext.Provider>\n    )\n  }\n\n  ContextProvider.displayName = `${displayName} Provider`\n\n  return [ContextProvider, useContext, nativeContext] as const\n}\n","/**\n * Creates a React Suspense handler for promises, allowing you to throw a promise to trigger React Suspense boundaries.\n *\n * @template T The resolved type of the promise\n * @param promise Optional promise to be handled by the suspense boundary\n * @returns A function to handle promises for Suspense, or the result/error tuple if promise is provided\n *\n * @example\n * // Usage with a promise\n * const [data, error] = createReactSuspense(fetchData())\n *\n * // Usage as a handler\n * const handleSuspense = createReactSuspense()\n * const [data, error] = handleSuspense(fetchData())\n */\nexport function createReactSuspense<T = void>(promise?: Promise<T>) {\n  let isPromiseResolved = false\n  let promiseData: unknown\n  let promiseError: unknown\n\n  function handlePromise<P extends Promise<unknown>>(\n    promise: P\n  ): [Awaited<P>, unknown] {\n    if (!isPromiseResolved) {\n      isPromiseResolved = true\n\n      promise\n        .then((res) => (promiseData = res))\n        .catch((err) => (promiseError = err))\n\n      throw promise\n    }\n\n    return [promiseData as Awaited<P>, promiseError] as const\n  }\n\n  function handleRootPromise(): [T, unknown] {\n    return handlePromise(promise!)\n  }\n\n  return (promise ? handleRootPromise : handlePromise) as T extends void\n    ? typeof handlePromise\n    : typeof handleRootPromise\n}\n","import { Component, ErrorInfo, ReactNode } from 'react'\n\ninterface ErrorBoundaryProps {\n  children: ReactNode\n  fallback: ReactNode | ((error: Error, errorInfo: ErrorInfo) => ReactNode)\n}\n\ninterface ErrorBoundaryState {\n  error: Error | null\n  errorInfo: ErrorInfo | null\n}\n\n/**\n * React error boundary component for catching and displaying errors in the component tree.\n *\n * @example\n * <ErrorBoundary fallback={<div>Something went wrong</div>}>\n *   <App />\n * </ErrorBoundary>\n */\nexport class ErrorBoundary extends Component<\n  ErrorBoundaryProps,\n  ErrorBoundaryState\n> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props)\n    this.state = { error: null, errorInfo: null }\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    this.setState({\n      error: error,\n      errorInfo: errorInfo,\n    })\n  }\n\n  render() {\n    const { children, fallback } = this.props\n    const { error, errorInfo } = this.state\n\n    if (!error) return children\n\n    if (typeof fallback === 'function') {\n      return (fallback as (error: Error, errorInfo: ErrorInfo) => ReactNode)(\n        error,\n        errorInfo as ErrorInfo\n      )\n    }\n\n    return fallback\n  }\n}\n","import { DependencyList, EffectCallback, useEffect, useRef } from 'react'\n\n/**\n * Like React's useEffect, but skips running the effect on the initial mount.\n *\n * @param effect Effect callback (same as useEffect)\n * @param dependencies Dependency list (same as useEffect)\n *\n * @example\n * useEffectExceptOnMount(() => {\n *   // Will not run on mount, only on updates\n *   console.log('Updated!')\n * }, [value])\n */\nexport function useEffectExceptOnMount(\n  effect: EffectCallback,\n  dependencies: DependencyList\n) {\n  const mounted = useRef(false)\n\n  useEffect(() => {\n    if (mounted.current) {\n      const unmount = effect()\n      return typeof unmount === 'function' ? unmount : undefined\n    } else {\n      mounted.current = true\n    }\n  }, dependencies)\n\n  useEffect(() => {\n    return () => {\n      mounted.current = false\n    }\n  }, [])\n}\n","import { DependencyList, useEffect, useState } from 'react'\n\nexport function useEffectState<T>(initialValue: T, deps?: DependencyList) {\n  const [state, setState] = useState(initialValue)\n\n  const dependency = Array.isArray(deps) ? deps : [initialValue]\n\n  useEffect(() => {\n    setState(initialValue)\n  }, dependency)\n\n  return [state, setState] as const\n}\n","import { useRef } from 'react'\n\n/**\n * React Suspense utility hook. Throws a promise when suspended is true, triggering a Suspense boundary.\n *\n * @param suspended If true, throws a promise to suspend rendering\n *\n * @example\n * useSuspense(isLoading)\n */\nexport function useSuspense(suspended: boolean = false) {\n  const promise = useRef<{ resolve: (...args: unknown[]) => void }>(undefined)\n\n  if (suspended && !promise.current) {\n    throw new Promise((resolve) => {\n      promise.current = { resolve }\n    })\n  }\n\n  if (!suspended && promise.current) {\n    promise.current.resolve()\n    promise.current = undefined\n  }\n}\n"],"names":["_jsx"],"mappings":"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"}